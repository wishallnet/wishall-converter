/* remington_typing.js */

// कीबोर्ड मैप: (English Key -> Unicode Hindi Output)
const remingtonMap = {
    '~': '़', '`': '़',
    '1': '१', '2': '२', '3': '३', '4': '४', '5': '५', '6': '६', '7': '७', '8': '८', '9': '९', '0': '०',
    '-': '.', '_': 'ऋ', '=': '.', '+': 'त्र',
    
    'Q': 'फّٰ', 'q': 'ु',
    'W': 'झ्', 'w': 'ू',
    'E': 'म्', 'e': 'म',
    'R': 'त्', 'r': 'त',
    'T': 'ज्', 't': 'ज',
    'Y': 'ल्', 'y': 'ल',
    'U': 'न्', 'u': 'न',
    'I': 'प्', 'i': 'प',
    'O': 'व्', 'o': 'व',
    'P': 'च्', 'p': 'च',
    '[': 'क्ष्', '{': 'क्ष',
    ']': 'द्व', '}': 'द्व',
    
    'A': ' ।', 'a': 'ं',
    'S': '्', 's': 'े',
    'D': '्', 'd': 'क',
    'F': 'थ्', 'f': 'ि',
    'G': 'ळ्', 'g': 'ह',
    'H': 'भ्', 'h': 'ी',
    'J': 'श्र', 'j': 'र',
    'K': 'ज्ञ', 'k': 'ा',
    'L': 'स्', 'l': 'स',
    ';': 'य', ':': 'रू',
    "'": 'श', '"': 'ष्',
    
    'Z': 'राष्ट्र', 'z': '्र',
    'X': 'ग्ध', 'x': 'ग',
    'C': 'ब', 'c': 'ब', // Remington अक्सर 'ब' को c या v पर रखता है
    'V': 'ट', 'v': 'अ', // कुछ लेआउट में भिन्नता हो सकती है
    'B': 'ठ', 'b': 'इ',
    'N': 'छ', 'n': 'द',
    'M': 'ड', 'm': 'उ',
    ',': 'ए', '<': 'ढे',
    '.': 'ण्', '>': '़',
    '/': 'ध्', '?': 'घ्'
};

// यह फंक्शन हर कीस्ट्रोक को चेक करेगा
function handleRemingtonTyping(e, textarea) {
    // Ctrl, Alt या Command कीज़ को इग्नोर करें (ताकि कॉपी-पेस्ट काम करे)
    if (e.ctrlKey || e.altKey || e.metaKey) return;

    // केवल प्रिंट होने वाले कैरेक्टर लें (Length 1)
    if (e.key.length !== 1) return;

    let charCode = e.key;
    
    // अगर मैप में वह अक्षर है
    if (remingtonMap[charCode]) {
        e.preventDefault(); // इंग्लिश अक्षर को टाइप होने से रोकें

        let hindiChar = remingtonMap[charCode];

        // कर्सर की पोजीशन निकालें
        let start = textarea.selectionStart;
        let end = textarea.selectionEnd;
        let text = textarea.value;

        // "f" (छोटी 'ि') की मात्रा का स्पेशल लॉजिक (रेमिंगटन में यह अक्षर के पहले टाइप होती है लेकिन यूनिकोड में बाद में)
        // नोट: सिंपल लाइव टाइपिंग के लिए हम इसे सीधे इनसर्ट कर रहे हैं।
        // एडवांस लॉजिक में 'ि' को पिछले अक्षर के बाद शिफ्ट करना होता है, 
        // लेकिन बेसिक टाइपिंग के लिए डायरेक्ट मैपिंग काफी है।
        
        // टेक्स्ट बॉक्स में हिंदी अक्षर जोड़ें
        textarea.value = text.substring(0, start) + hindiChar + text.substring(end);

        // कर्सर को सही जगह ले जाएं
        textarea.selectionStart = textarea.selectionEnd = start + hindiChar.length;
    }
}